import{_ as C}from"./extends-CF3RwP-h.js";import{r}from"./index-Dl6G-zuu.js";import{a as h}from"./index-COmNUzeK.js";import{$ as L,a as S}from"./index-QZw2BAii.js";import{$ as U}from"./index-BSTPHMlZ.js";import{b as y}from"./index-D_wDWxb3.js";import{R as z}from"./index-D1_ZHIBm.js";function A(o,e=globalThis==null?void 0:globalThis.document){const n=y(o);r.useEffect(()=>{const s=t=>{t.key==="Escape"&&n(t)};return e.addEventListener("keydown",s),()=>e.removeEventListener("keydown",s)},[n,e])}const p="dismissableLayer.update",K="dismissableLayer.pointerDownOutside",N="dismissableLayer.focusOutside";let T;const H=r.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Z=r.forwardRef((o,e)=>{var n;const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:t,onPointerDownOutside:d,onFocusOutside:b,onInteractOutside:l,onDismiss:u,...v}=o,a=r.useContext(H),[c,R]=r.useState(null),f=(n=c==null?void 0:c.ownerDocument)!==null&&n!==void 0?n:globalThis==null?void 0:globalThis.document,[,F]=r.useState({}),I=U(e,i=>R(i)),m=Array.from(a.layers),[W]=[...a.layersWithOutsidePointerEventsDisabled].slice(-1),_=m.indexOf(W),O=c?m.indexOf(c):-1,B=a.layersWithOutsidePointerEventsDisabled.size>0,D=O>=_,k=M(i=>{const E=i.target,g=[...a.branches].some($=>$.contains(E));!D||g||(d==null||d(i),l==null||l(i),i.defaultPrevented||u==null||u())},f),P=X(i=>{const E=i.target;[...a.branches].some($=>$.contains(E))||(b==null||b(i),l==null||l(i),i.defaultPrevented||u==null||u())},f);return A(i=>{O===a.layers.size-1&&(t==null||t(i),!i.defaultPrevented&&u&&(i.preventDefault(),u()))},f),r.useEffect(()=>{if(c)return s&&(a.layersWithOutsidePointerEventsDisabled.size===0&&(T=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),a.layersWithOutsidePointerEventsDisabled.add(c)),a.layers.add(c),w(),()=>{s&&a.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=T)}},[c,f,s,a]),r.useEffect(()=>()=>{c&&(a.layers.delete(c),a.layersWithOutsidePointerEventsDisabled.delete(c),w())},[c,a]),r.useEffect(()=>{const i=()=>F({});return document.addEventListener(p,i),()=>document.removeEventListener(p,i)},[]),r.createElement(L.div,C({},v,{ref:I,style:{pointerEvents:B?D?"auto":"none":void 0,...o.style},onFocusCapture:h(o.onFocusCapture,P.onFocusCapture),onBlurCapture:h(o.onBlurCapture,P.onBlurCapture),onPointerDownCapture:h(o.onPointerDownCapture,k.onPointerDownCapture)}))});function M(o,e=globalThis==null?void 0:globalThis.document){const n=y(o),s=r.useRef(!1),t=r.useRef(()=>{});return r.useEffect(()=>{const d=l=>{if(l.target&&!s.current){let v=function(){x(K,n,u,{discrete:!0})};const u={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",t.current),t.current=v,e.addEventListener("click",t.current,{once:!0})):v()}else e.removeEventListener("click",t.current);s.current=!1},b=window.setTimeout(()=>{e.addEventListener("pointerdown",d)},0);return()=>{window.clearTimeout(b),e.removeEventListener("pointerdown",d),e.removeEventListener("click",t.current)}},[e,n]),{onPointerDownCapture:()=>s.current=!0}}function X(o,e=globalThis==null?void 0:globalThis.document){const n=y(o),s=r.useRef(!1);return r.useEffect(()=>{const t=d=>{d.target&&!s.current&&x(N,n,{originalEvent:d},{discrete:!1})};return e.addEventListener("focusin",t),()=>e.removeEventListener("focusin",t)},[e,n]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function w(){const o=new CustomEvent(p);document.dispatchEvent(o)}function x(o,e,n,{discrete:s}){const t=n.originalEvent.target,d=new CustomEvent(o,{bubbles:!1,cancelable:!0,detail:n});e&&t.addEventListener(o,e,{once:!0}),s?S(t,d):t.dispatchEvent(d)}const ee=r.forwardRef((o,e)=>{var n;const{container:s=globalThis==null||(n=globalThis.document)===null||n===void 0?void 0:n.body,...t}=o;return s?z.createPortal(r.createElement(L.div,C({},t,{ref:e})),s):null});export{ee as $,Z as a};
